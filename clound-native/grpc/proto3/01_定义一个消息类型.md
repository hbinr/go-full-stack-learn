本系列文章描述了如何使用Protocol buffer 语言去描述你的protocol buffer 数据， 包括 .proto文件符号和如何从.proto文件生成类。

包含了proto2版本的protocol buffer语言：对于老版本的proto3 符号，请见[Proto2 Language Guide](https://developers.google.com/protocol-buffers/docs/proto?hl=zh-cn)（以及[中文译本](https://colobu.com/2015/01/07/Protobuf-language-guide/)）

本系列文章是一个参考指南——如果要查看如何使用本文中描述的多个特性的循序渐进的例子，请在[官网教程](https://developers.google.com/protocol-buffers/docs/proto3?hl=zh-cn)中查找需要的语言的教程。


# 定义一个消息类型
先来看一个非常简单的例子。假设你想定义一个“搜索请求”的消息格式，每一个请求含有一个查询字符串、你感兴趣的查询结果所在的页数，以及每一页多少条查询结果。可以采用如下的方式来定义消息类型的.proto文件了：

```go
syntax = "proto3";

message SearchRequest {
  string query = 1;
  int32 page_number = 2;
  int32 result_per_page = 3;
}
```
- 文件的第一行指定了你正在使用`proto3`语法：如果你没有指定这个，编译器会使用`proto2`。这个指定语法行必须是文件的非空非注释的第一个行。
- SearchRequest消息格式有3个字段，在消息中承载的数据分别对应于每一个字段。其中每个字段都有一个名字和一种类型。

## 指定字段类型
在上面的例子中，所有字段都是标量类型：
- 两个整型（page_number和result_per_page）
- 一个string类型（query）
当然，你也可以为字段指定其他的合成类型，包括枚举（enumerations）或其他消息类型。

## 分配标识号
正如你所见，在消息定义中，每个字段都有唯一的一个数字标识符。这些标识符是用来在消息的二进制格式中识别各个字段的，一旦开始使用就不能够再改变。

**注：**
- [1,15]之内的标识号在编码的时候会占用一个字节。
- [16,2047]之内的标识号则占用2个字节。

所以应该**为那些频繁出现的消息元素保留 [1,15]之内的标识号**。

**切记：要为将来有可能添加的、频繁出现的标识号预留一些标识号。**

最小的标识号可以从**1**开始，最大到2^29 - 1, or 536,870,911。

**不可以使用**其中的**[19000－19999]**（ (从FieldDescriptor::kFirstReservedNumber 到 FieldDescriptor::kLastReservedNumber)）的标识号， Protobuf协议实现中对这些进行了预留。

如果非要在.proto文件中使用这些预留标识号，编译时就会报警。同样你也不能使用早期保留的标识号。


## 指定字段规则
所指定的消息字段修饰符必须是如下之一：

- singular：一个格式良好的消息应该有0个或者1个这种字段（但是不能超过1个）。
- repeated：在一个格式良好的消息中，这种字段可以重复任意多次（包括0次）。重复的值的顺序会被保留。
- 
在proto3中，repeated的标量域默认情况下使用packed。

版本2.1.0引入了packed repeated 字段，在proto2中声明为 repeated 字段，但使用特殊的[packed = true]选项。 在proto3中，默认情况下 packed 标量数字类型的 repeated 字段。 其功能类似于 repeated 字段，但编码方式不同。 

包含零元素的压缩 packed repeated 字段不会出现在编码的消息中。 否则，该字段的所有元素都将打包为 wire type 2（length-delimited）的单个键值对。 每个元素的编码方式与通常相同，不同之处在于之前没有键。

packed 用实例:
```go
message Test4 {
  repeated int32 d = 4 [packed=true];
}
```

**注意：** 
- 只能将原始数字类型（使用varint，32位或64位线型的类型）的重复字段声明为 `packed`。

你可以了解更多的pakced属性在 [官方Protocol Buffer 编码](https://developers.google.com/protocol-buffers/docs/encoding?hl=zh-cn#packed)