# 数据结构和内部编码

type 命令实际返回的就是当前键的数据结构类型，它们分别是：string
（字符串）、hash（哈希）、list（列表）、set（集合）、zset（有序集合），
但这些只是 Redis 对外的数据结构，如图 2-1 所⽰。
![图 2-1 Redis 的 5 种数据结构](./../img/图%202-1%20Redis%20的%205%20种数据结构.jpg)

实际上每种数据结构都有⾃⼰底层的内部编码实现，⽽且是多种实现，
这样 Redis 会在合适的场景选择合适的内部编码，如图 2-2 所⽰。

![图 2-2 Redis 数据结构和内部编码](../../img/图%202-2%20Redis%20数据结构和内部编码.jpg)

可以看到每种数据结构都有两种以上的内部编码实现，例如 list 数据结
构包含了 linkedlist 和 ziplist 两种内部编码。同时有些内部编码，例如
ziplist，可以作为多种外部数据结构的内部实现，可以通过 object
encoding 命令查询内部编码：

```
127.0.0.1:6379> object encoding hello
"embstr"
127.0.0.1:6379> object encoding mylist
"ziplist"
```

可以看到键 hello 对应值的内部编码是 embstr，键 mylist 对应值的内
部编码是 ziplist。

Redis 这样设计有两个好处：

- 第⼀，可以改进内部编码，⽽对外的数据
  结构和命令没有影响，这样⼀旦开发出更优秀的内部编码，⽆需改动外部数
  据结构和命令，例如 Redis3.2 提供了 quicklist ，结合了 ziplist 和
  linkedlist 两者的优势，为列表类型提供了⼀种更为优秀的内部编码实现，
  ⽽对外部⽤⼾来说基本感知不到。
- 第⼆，多种内部编码实现可以在不同场景
  下发挥各⾃的优势，例如 ziplist ⽐较节省内存，但是在列表元素⽐较多的
  情况下，性能会有所下降，这时候 Redis 会根据配置选项将列表类型的内部
  实现转换为 linkedlist 。
