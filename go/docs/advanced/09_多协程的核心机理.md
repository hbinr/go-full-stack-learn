# 多协程的核心机理

## 多协程的定义
**官方定义：** 一段时间内协程的并行

**实际应用：** 某个任务使用多个协程同时进行处理


## 多协程的相对性

以做一道菜为例：

- 同时处理非同一道菜的食材——不算多协程
- 同时处理同一道菜的食材——算多协程
- 同时处理同一道菜的同一种食材——算多协程



## 多协程的必要条件

- 协程任务之间有关联性
  - 相互之间组成整体任务
  - 相互之间有连续性
- 有总分总的协程步骤过程

## 多协程的任务步骤

1. 任务切分/分配
2. 启动多个协程
3. 合并多个协程的结果

## 多协程的使用场景

- 运算量比较多的流程上
- 协程间的依赖性（耦合性）比较弱，如B任务执行不依赖于A任务的输出

## 多协程的局限性

### 主要的耗时

- 分配工作耗时T1
- 并发运算时的耗时T2
- 合并结果的耗时T3
### 局限
当出现以下情况，不推荐使用多协程：

1. T1 > T2  or
2. T3 > T2  or
3. T1+T3 > T2  or

否则会带来额外的影响：
- 增加额外的耗时，若分配任务或合并任务的耗时过高，那么占用CPU的过久，会影响后续其他流程的执行效率；合并结果之前需要等到所有的结果都运行完毕才能合并，因此将会存在一个协程等待的问题，协程等待也是高并发中的一个重要的性能瓶颈。
- 增加额外的内存消耗，大量的任务在CPU中持续运行，会给系统带来额外的内存压力，因为协程所需要的数据在协程运行期间一直保留在内存中。