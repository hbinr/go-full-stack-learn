# channel 使用注意事项


## 什么情况下使用 channel 会panic

- 关闭为nil的channel
- 关闭已经关闭了的channel
- 向已经关闭的channel中发送（写）数据

**注意：以下场景不会引发panic，而是会阻塞**

- 向为nil的channel中读数据
- 向为nil的channel中写数据

## 什么情况下，操作channel会阻塞

goroutine 读取管道时，阻塞的条件有：
- 管道无缓冲区
- 管道的缓冲区中无数据
- 管道的值为nil


goroutine 写入管道时，阻塞的条件有：
- 管道无缓冲区
- 管道的缓冲区已满
- 管道的值为nil

## channel读取表达式

最常见的表达式是直接读channel即可，如 `value := <-ch`，另外一种是：
```go
value, ok := <-ch
```
`value`表示读出的数据， `ok`为bool类型，表示是否成功读取了数据，需要注意的是，其不用于表示channel的关闭状态

第二个变量`ok`常被误解成管道的关闭状态，那是因为它的值确实和channel的关闭状态有关，更确切地说**和channel缓冲区是否有数据有关**

一个已关闭的channel有两种情况：
- 管道缓冲区已没有数据
- 管道缓冲区还有数据

对于第一种情况，管道已关闭，且缓冲区中没有数据，那么管道读取表达式返回的第一个变量为相应类型的零值，第二个变量为false。

对于第二种情况，管道已关闭，但缓冲区中仍有数据，那么管道读取表达式返回的第一个变量为读取到的值，第二个变量为true。

可以看到，只有管道已关闭，且缓冲区中没有数据时，管道读取表达式返回的第二个变量才和管道关闭状态一致。
